name: Check User Existence via Jenkins

on:
  workflow_dispatch:
    inputs:
      username:
        description: 'Username to check in /etc/passwd'
        required: true
        type: string

jobs:
  trigger-jenkins-job:
    runs-on: self-hosted

    steps:
    - name: Trigger Jenkins Job
      run: |
        set -e
        
        echo "Checking user: ${{ github.event.inputs.username }}"
        
        CRUMB_JSON=$(curl -s -u "${{ secrets.JENKINS_ADMIN }}:${{ secrets.JENKINS_TOKEN }}" \
          "${{ secrets.JENKINS_URL }}/crumbIssuer/api/json")
        
        CRUMB=$(echo "$CRUMB_JSON" | jq -r .crumb)
        CRUMB_FIELD=$(echo "$CRUMB_JSON" | jq -r .crumbRequestField)
        
        echo "Using crumb field: $CRUMB_FIELD"
        
        curl -v -X POST \
          -u "${{ secrets.JENKINS_ADMIN }}:${{ secrets.JENKINS_TOKEN }}" \
          -H "$CRUMB_FIELD: $CRUMB" \
          "${{ secrets.JENKINS_URL }}/job/${{ secrets.JOB_NAME }}/buildWithParameters?USERNAME=${{ github.event.inputs.username }}"

      

